<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Kauê Miziara">
<meta name="dcterms.date" content="2026-01-08">

<title>Quantum Machine Learning in Practice</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="vqe_in_practice_files/libs/clipboard/clipboard.min.js"></script>
<script src="vqe_in_practice_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="vqe_in_practice_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="vqe_in_practice_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="vqe_in_practice_files/libs/quarto-html/popper.min.js"></script>
<script src="vqe_in_practice_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="vqe_in_practice_files/libs/quarto-html/anchor.min.js"></script>
<link href="vqe_in_practice_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="vqe_in_practice_files/libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="vqe_in_practice_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="vqe_in_practice_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="vqe_in_practice_files/libs/bootstrap/bootstrap-0a61af393cc41664e89a7addda21b354.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#problem-definition" id="toc-problem-definition" class="nav-link active" data-scroll-target="#problem-definition">0 - Problem Definition</a>
  <ul class="collapse">
  <li><a href="#player-data" id="toc-player-data" class="nav-link" data-scroll-target="#player-data">Player Data</a></li>
  </ul></li>
  <li><a href="#mapping" id="toc-mapping" class="nav-link" data-scroll-target="#mapping">1 - Mapping</a>
  <ul class="collapse">
  <li><a href="#objective-function" id="toc-objective-function" class="nav-link" data-scroll-target="#objective-function">Objective Function</a></li>
  <li><a href="#penalty-functions" id="toc-penalty-functions" class="nav-link" data-scroll-target="#penalty-functions">Penalty Functions</a></li>
  <li><a href="#mapping-code" id="toc-mapping-code" class="nav-link" data-scroll-target="#mapping-code">Mapping Code</a></li>
  </ul></li>
  <li><a href="#vqe-preparation" id="toc-vqe-preparation" class="nav-link" data-scroll-target="#vqe-preparation">2 - VQE Preparation</a>
  <ul class="collapse">
  <li><a href="#ansatz" id="toc-ansatz" class="nav-link" data-scroll-target="#ansatz">Ansatz</a></li>
  <li><a href="#classical-optimizer" id="toc-classical-optimizer" class="nav-link" data-scroll-target="#classical-optimizer">Classical Optimizer</a></li>
  <li><a href="#cost-function" id="toc-cost-function" class="nav-link" data-scroll-target="#cost-function">Cost Function</a></li>
  <li><a href="#algorithm-execution" id="toc-algorithm-execution" class="nav-link" data-scroll-target="#algorithm-execution">Algorithm Execution</a></li>
  </ul></li>
  <li><a href="#post-processing-and-analysis" id="toc-post-processing-and-analysis" class="nav-link" data-scroll-target="#post-processing-and-analysis">3 - Post-Processing and Analysis</a></li>
  <li><a href="#resources" id="toc-resources" class="nav-link" data-scroll-target="#resources">Resources</a></li>
  <li><a href="#copyright-and-licensing-note" id="toc-copyright-and-licensing-note" class="nav-link" data-scroll-target="#copyright-and-licensing-note">Copyright and Licensing Note</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="vqe_in_practice.md"><i class="bi bi-file-code"></i>Github (GFM)</a></li><li><a href="vqe_in_practice.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="vqe_in_practice.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Quantum Machine Learning in Practice</h1>
<p class="subtitle lead">Solving an Optimization Problem with the Variational Quantum Eigensolver</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Kauê Miziara </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 8, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="problem-definition" class="level2">
<h2 class="anchored" data-anchor-id="problem-definition">0 - Problem Definition</h2>
<p>We have a group of 6 people and we want to divide them into two teams, such that the skill level of each one is similar.</p>
<ul>
<li>Each person has a skill level</li>
<li>Some people are goalkeepers</li>
</ul>
<p><code>Objective</code>: separate the players into two teams</p>
<ul>
<li><blockquote class="blockquote">
<p>teams must have equal (or similar) skills</p>
</blockquote></li>
<li>not everyone needs to be chosen</li>
<li>teams do not necessarily need to have the same number of members</li>
</ul>
<p><code>Constraints</code>:</p>
<ul>
<li><blockquote class="blockquote">
<p>each player cannot be on more than one team</p>
</blockquote></li>
<li><blockquote class="blockquote">
<p>each team must have exactly one goalkeeper</p>
</blockquote></li>
</ul>
<section id="player-data" class="level3">
<h3 class="anchored" data-anchor-id="player-data">Player Data</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Player</th>
<th>Skill</th>
<th>Goalkeeper?</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Alice</td>
<td>5</td>
<td>No</td>
</tr>
<tr class="even">
<td>Bob</td>
<td>6</td>
<td>Yes</td>
</tr>
<tr class="odd">
<td>Claire</td>
<td>8</td>
<td>Yes</td>
</tr>
<tr class="even">
<td>Danny</td>
<td>4</td>
<td>No</td>
</tr>
<tr class="odd">
<td>Eve</td>
<td>6</td>
<td>No</td>
</tr>
<tr class="even">
<td>Frank</td>
<td>9</td>
<td>No</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="mapping" class="level2">
<h2 class="anchored" data-anchor-id="mapping">1 - Mapping</h2>
<p>We will use binary variables to write the problem in the QUBO model.</p>
<p>The variables <span class="math inline">\((x_0,\dots, x_5)\)</span> represent the players in <strong>Team A</strong><br>
The variables <span class="math inline">\((x_6,\dots, x_{11})\)</span> represent the players in <strong>Team B</strong></p>
<p>If <span class="math inline">\(x_i=1\)</span>, the corresponding player is in the team associated with <span class="math inline">\(i\)</span>; otherwise, <span class="math inline">\(x_i=0\)</span>.</p>
<ul>
<li>For example, <span class="math inline">\(x_0=1\)</span> and <span class="math inline">\(x_6=0\)</span> means that Alice <em>is</em> in Team A and <em>is not</em> in Team B.</li>
</ul>
<section id="objective-function" class="level3">
<h3 class="anchored" data-anchor-id="objective-function">Objective Function</h3>
<p>If we are going to create two teams, we can define the function as:</p>
<p><span class="math display">\[Obj = \left(\sum s_A - \sum s_B\right)^2\]</span></p>
<p>Where <span class="math inline">\(\sum s_i\)</span> represents the total skill of the players in Team <span class="math inline">\(i\)</span>.</p>
<p>We square it so that the value is always positive, preventing the algorithm from assigning all players to the same team.</p>
<ul>
<li>This error could happen if Team B’s skill is much higher than Team A’s, generating a very negative result.</li>
<li>By squaring, the lowest possible value is zero (if the teams have equal skill).</li>
</ul>
<p>To make the result generic for <span class="math inline">\(N\)</span> teams (besides enabling us to make adjustments to the model of specific teams), we can generalize the objective function by calculating specific objectives for each team.</p>
<p>To do this, we can calculate the skill difference between each team <span class="math inline">\(i\)</span> and the “fair” distribution of skills, <span class="math inline">\(ED\)</span>:</p>
<p><span class="math display">\[ED=\frac{\sum s_i}{N}\]</span></p>
<p>Where <span class="math inline">\(s_i\)</span> is each person’s skill and <span class="math inline">\(N\)</span> is the number of teams.</p>
<p>In this case, the objective function will be:</p>
<p><span class="math display">\[Obj=\sum_i O_i\]</span></p>
<p>Where:</p>
<p><span class="math display">\[O_i = \left(\sum (s_ix_i) - ED\right)\]</span></p>
<p>With <span class="math inline">\(s_i\)</span> being the skill of each player <span class="math inline">\(i\)</span> and <span class="math inline">\(x_i\)</span> the variable indicating whether <span class="math inline">\(i\)</span> should be on the team or not.</p>
<ul>
<li>For example, we are talking about Alice when <span class="math inline">\(i=0\)</span> or <span class="math inline">\(i=6\)</span>, therefore, <span class="math inline">\(s_0=s_6=5\)</span>.</li>
</ul>
<p>Expanding the function in our case, we have:</p>
<p><span class="math display">\[ED = \frac{\sum s_i}{2}=19\]</span></p>
<p><span class="math display">\[O_0 = \left(\sum_{i\in[0,5]}s_ix_i - ED \right)^2 = [(5x_0 + 6x_1 + 8x_2 + 4x_3 + 6x_4 + 9x_5) - ED]^2\]</span> <span class="math display">\[O_1 = \left(\sum_{i\in[6,11]}s_ix_i - ED \right)^2 = [(5x_6 + 6x_7 + 8x_8 + 4x_9 + 6x_{10} + 9x_{11}) - ED]^2\]</span> <span class="math display">\[Obj = [(5x_0 + 6x_1 + 8x_2 + 4x_3 + 6x_4 + 9x_5) - 19]^2 + [(5x_6 + 6x_7 + 8x_8 + 4x_9 + 6x_{10} + 9x_{11}) - 19]^2\]</span></p>
<p>Although this is a valid QUBO model problem, we can still encounter issues, for example:</p>
<ul>
<li>Allocating all players to a single team</li>
<li>Allocating one player to all teams</li>
<li>Not allocating players, keeping <span class="math inline">\(N\)</span> teams with <span class="math inline">\(0\)</span> members (consequently, <span class="math inline">\(Obj=0\)</span>, as we wanted, but not in a correct way)</li>
</ul>
<p>To get around possible problems, we add constraints to the model.</p>
</section>
<section id="penalty-functions" class="level3">
<h3 class="anchored" data-anchor-id="penalty-functions">Penalty Functions</h3>
<p>For each constraint in the problem, we add a term to our model containing a function representing it.</p>
<p>The first constraint (a player cannot be on more than one team) can be written as:</p>
<p><span class="math display">\[x + y \leq 1\]</span></p>
<p>Since our variables can only take values <span class="math inline">\(0\)</span> or <span class="math inline">\(1\)</span>, the inequality forces at least one of the variables to be equal to <span class="math inline">\(0\)</span>.</p>
<p>This type of constraint is so common that we have a ready-made penalty function for it:</p>
<p><span class="math display">\[\lambda(xy)\]</span></p>
<p>Where <span class="math inline">\(\lambda\)</span> is a penalty constant, which will be decided later.</p>
<p>In this case, for each player (and their associated pair of variables), we will have a penalty term. For example, for Alice:</p>
<p><span class="math display">\[x_0+x_6 \leq 1 \xrightarrow{} \lambda_1(x_0x_6)=c_1\]</span></p>
<p>Our second type of constraint concerns the goalkeepers; for this, we simply do something similar.</p>
<p>To ensure that each goalkeeper is in at most one of the teams, we create a constraint stating that we cannot have more than one goalkeeper in a given team.</p>
<p>Since our example has two goalkeepers:</p>
<p><span class="math display">\[x_1+x_2 \leq 1 \xrightarrow{} \lambda_2(x_1x_2)=c_7\]</span> <span class="math display">\[x_7+x_8 \leq 1 \xrightarrow{} \lambda_2(x_7x_8)=c_8\]</span></p>
<p>We will add the penalty functions to the objective function terms, ensuring that the constraints apply.</p>
<p>To choose the <span class="math inline">\(\lambda\)</span> values, we need to keep in mind that:</p>
<ul>
<li>We normally use integer values</li>
<li>They must be large enough to increase the objective function value if the constraint is violated</li>
<li>They cannot be too high, so as not to bias the objective function</li>
<li><ul>
<li>The model would prioritize satisfying all constraints over minimizing the function</li>
</ul></li>
<li>They cannot be too low, otherwise the model would allow too many violations</li>
</ul>
</section>
<section id="mapping-code" class="level3">
<h3 class="anchored" data-anchor-id="mapping-code">Mapping Code</h3>
<p>Thus, our final function will be the cost function <span class="math inline">\(C\)</span> such that:</p>
<p><span class="math display">\[C = Obj + \sum c_i\]</span></p>
<p>Where <span class="math inline">\(c_i\)</span> are the penalty functions.</p>
<p>Therefore:</p>
<p><span class="math display">\[C = \sum O_i + \sum c_i\]</span> <span class="math display">\[C = \left(\sum_{i\in[0,5]}s_ix_i - ED \right)^2 + \left(\sum_{i\in[6,11]}s_ix_i - ED \right)^2 + \lambda_1(x_0x_6 + \dots + x_5x_{11}) + \lambda_2(x_1x_2 + x_7x_8)\]</span></p>
<p>We can finally map our problem to a quantum computer using Qiskit.</p>
<div id="a0102797" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Sequence</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="e3760bc3" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> qiskit <span class="im">import</span> QuantumCircuit</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> qiskit.circuit.library <span class="im">import</span> EfficientSU2</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="e8247fc2" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> qiskit_aer.primitives <span class="im">import</span> Estimator <span class="im">as</span> AerEstimator</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> qiskit_aer.primitives <span class="im">import</span> Sampler <span class="im">as</span> AerSampler</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="3a672f27" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> qiskit_optimization <span class="im">import</span> QuadraticProgram</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> qiskit_optimization.converters <span class="im">import</span> QuadraticProgramToQubo</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="bfaad524" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Problem data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>players_data <span class="op">=</span> [</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"name"</span>: <span class="st">"Alice"</span>,  <span class="st">"strength"</span>: <span class="dv">5</span>, <span class="st">"isGoalkeeper"</span>: <span class="va">False</span>},</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"name"</span>: <span class="st">"Bob"</span>,    <span class="st">"strength"</span>: <span class="dv">6</span>, <span class="st">"isGoalkeeper"</span>: <span class="va">True</span> },</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"name"</span>: <span class="st">"Claire"</span>, <span class="st">"strength"</span>: <span class="dv">8</span>, <span class="st">"isGoalkeeper"</span>: <span class="va">True</span> },</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"name"</span>: <span class="st">"Danny"</span>,  <span class="st">"strength"</span>: <span class="dv">4</span>, <span class="st">"isGoalkeeper"</span>: <span class="va">False</span>},</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"name"</span>: <span class="st">"Eve"</span>,    <span class="st">"strength"</span>: <span class="dv">6</span>, <span class="st">"isGoalkeeper"</span>: <span class="va">False</span>},</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    {<span class="st">"name"</span>: <span class="st">"Frank"</span>,  <span class="st">"strength"</span>: <span class="dv">9</span>, <span class="st">"isGoalkeeper"</span>: <span class="va">False</span>},</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>teams <span class="op">=</span> [<span class="st">"Alpha"</span>, <span class="st">"Beta"</span>]</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>num_players <span class="op">=</span> <span class="bu">len</span>(players_data)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>num_teams <span class="op">=</span> <span class="bu">len</span>(teams)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="ab176836" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>strengths <span class="op">=</span> [p[<span class="st">'strength'</span>] <span class="cf">for</span> p <span class="kw">in</span> players_data]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>goalkeeper_indices <span class="op">=</span> [i <span class="cf">for</span> i, p <span class="kw">in</span> <span class="bu">enumerate</span>(players_data) <span class="cf">if</span> p[<span class="st">'isGoalkeeper'</span>]]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="c8a5ecf6" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>total_strength <span class="op">=</span> <span class="bu">sum</span>(strengths)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>equal_dist <span class="op">=</span> total_strength <span class="op">/</span> num_teams</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="fdf946f3" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the optimization model</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>qp <span class="op">=</span> QuadraticProgram(<span class="st">"FootballTeamSelection"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="918dc14a" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Define binary variables</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_players):</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(num_teams):</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>        qp.binary_var(name<span class="op">=</span><span class="ss">f'x_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>t<span class="sc">}</span><span class="ss">'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>The objective function in the code comes from the expansion of our <span class="math inline">\(O_i\)</span>. Let <span class="math inline">\(X_i\)</span> be the total strength of team <span class="math inline">\(i\)</span>:</p>
<p><span class="math display">\[O_i = \left(X_i - ED\right)^2 = X_i^2 - 2\cdot X_i\cdot ED + ED^2\]</span></p>
<ul>
<li><span class="math inline">\(X_i^2\)</span> comes from the total team strength; in the expansion, each player <span class="math inline">\(i\)</span> is multiplied by every player <span class="math inline">\(j\)</span> on the same team (since it is the multiplication of a sum).</li>
<li><ul>
<li>That is why we say this is the <em>quadratic</em> term, as it depends on two players at a time.</li>
</ul></li>
<li><span class="math inline">\((-2)\cdot X_i\cdot ED\)</span> is a coefficient that depends only on each player <span class="math inline">\(i\)</span> once.</li>
<li><ul>
<li>That is why we say this is the <em>linear</em> term, as it only varies with one player.</li>
</ul></li>
<li><span class="math inline">\(ED^2\)</span>, in turn, does not depend on any player.</li>
<li><ul>
<li>Since its value is always the same, we call it the <em>constant</em> term.</li>
</ul></li>
</ul>
<div id="0e1147cf" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Define the objective function</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>linear_coeffs <span class="op">=</span> {}</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>quadratic_coeffs <span class="op">=</span> {}</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>constant <span class="op">=</span> num_teams <span class="op">*</span> (equal_dist <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(num_teams):</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_players):</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Linear term:</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        var_name <span class="op">=</span> <span class="ss">f'x_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>t<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        linear_coeffs[var_name] <span class="op">=</span> <span class="op">-</span><span class="dv">2</span> <span class="op">*</span> strengths[i] <span class="op">*</span> equal_dist</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(num_players):</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Quadratic term:</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>            var1_name <span class="op">=</span> <span class="ss">f'x_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>t<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>            var2_name <span class="op">=</span> <span class="ss">f'x_</span><span class="sc">{</span>j<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>t<span class="sc">}</span><span class="ss">'</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>            quadratic_coeffs[(var1_name, var2_name)] <span class="op">=</span> strengths[i] <span class="op">*</span> strengths[j]</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>qp.minimize(constant<span class="op">=</span>constant, linear<span class="op">=</span>linear_coeffs, quadratic<span class="op">=</span>quadratic_coeffs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="a56c309d" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Add constraints</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Each player in exactly one team</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(num_players):</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    player_assignment_vars <span class="op">=</span> {<span class="ss">f'x_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>t<span class="sc">}</span><span class="ss">'</span>: <span class="dv">1</span> <span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(num_teams)}</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    qp.linear_constraint(linear<span class="op">=</span>player_assignment_vars, sense<span class="op">=</span><span class="st">'=='</span>, rhs<span class="op">=</span><span class="dv">1</span>, name<span class="op">=</span><span class="ss">f'player_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_assignment'</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># At most one goalkeeper per team</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> t <span class="kw">in</span> <span class="bu">range</span>(num_teams):</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    goalkeeper_assignment_vars <span class="op">=</span> {<span class="ss">f'x_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_</span><span class="sc">{</span>t<span class="sc">}</span><span class="ss">'</span>: <span class="dv">1</span> <span class="cf">for</span> i <span class="kw">in</span> goalkeeper_indices}</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    qp.linear_constraint(linear<span class="op">=</span>goalkeeper_assignment_vars, sense<span class="op">=</span><span class="st">'&lt;='</span>, rhs<span class="op">=</span><span class="dv">1</span>, name<span class="op">=</span><span class="ss">f'team_</span><span class="sc">{</span>t<span class="sc">}</span><span class="ss">_goalkeeper'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="0f52724e" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Optimization Model (QuadraticProgram) defined."</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(qp.prettyprint())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Optimization Model (QuadraticProgram) defined.
Problem name: FootballTeamSelection

Minimize
  25*x_0_0^2 + 60*x_0_0*x_1_0 + 80*x_0_0*x_2_0 + 40*x_0_0*x_3_0 + 60*x_0_0*x_4_0
  + 90*x_0_0*x_5_0 + 25*x_0_1^2 + 60*x_0_1*x_1_1 + 80*x_0_1*x_2_1
  + 40*x_0_1*x_3_1 + 60*x_0_1*x_4_1 + 90*x_0_1*x_5_1 + 36*x_1_0^2
  + 96*x_1_0*x_2_0 + 48*x_1_0*x_3_0 + 72*x_1_0*x_4_0 + 108*x_1_0*x_5_0
  + 36*x_1_1^2 + 96*x_1_1*x_2_1 + 48*x_1_1*x_3_1 + 72*x_1_1*x_4_1
  + 108*x_1_1*x_5_1 + 64*x_2_0^2 + 64*x_2_0*x_3_0 + 96*x_2_0*x_4_0
  + 144*x_2_0*x_5_0 + 64*x_2_1^2 + 64*x_2_1*x_3_1 + 96*x_2_1*x_4_1
  + 144*x_2_1*x_5_1 + 16*x_3_0^2 + 48*x_3_0*x_4_0 + 72*x_3_0*x_5_0 + 16*x_3_1^2
  + 48*x_3_1*x_4_1 + 72*x_3_1*x_5_1 + 36*x_4_0^2 + 108*x_4_0*x_5_0 + 36*x_4_1^2
  + 108*x_4_1*x_5_1 + 81*x_5_0^2 + 81*x_5_1^2 - 190*x_0_0 - 190*x_0_1
  - 228*x_1_0 - 228*x_1_1 - 304*x_2_0 - 304*x_2_1 - 152*x_3_0 - 152*x_3_1
  - 228*x_4_0 - 228*x_4_1 - 342*x_5_0 - 342*x_5_1 + 722

Subject to
  Linear constraints (8)
    x_0_0 + x_0_1 == 1  'player_0_assignment'
    x_1_0 + x_1_1 == 1  'player_1_assignment'
    x_2_0 + x_2_1 == 1  'player_2_assignment'
    x_3_0 + x_3_1 == 1  'player_3_assignment'
    x_4_0 + x_4_1 == 1  'player_4_assignment'
    x_5_0 + x_5_1 == 1  'player_5_assignment'
    x_1_0 + x_2_0 &lt;= 1  'team_0_goalkeeper'
    x_1_1 + x_2_1 &lt;= 1  'team_1_goalkeeper'

  Binary variables (12)
    x_0_0 x_0_1 x_1_0 x_1_1 x_2_0 x_2_1 x_3_0 x_3_1 x_4_0 x_4_1 x_5_0 x_5_1
</code></pre>
</div>
</div>
<div id="a166c9f6" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>converter <span class="op">=</span> QuadraticProgramToQubo()</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>qubo <span class="op">=</span> converter.convert(qp)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>hamiltonian, offset <span class="op">=</span> qubo.to_ising()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>num_qubits <span class="op">=</span> hamiltonian.num_qubits</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="22c2b611" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"The problem was mapped to a Hamiltonian of </span><span class="sc">{</span>num_qubits<span class="sc">}</span><span class="ss"> qubits."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>The problem was mapped to a Hamiltonian of 12 qubits.</code></pre>
</div>
</div>
<div id="60995266" class="cell" data-execution_count="15">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(hamiltonian)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>SparsePauliOp(['IIIIIIIIIZII', 'IIIIIIIZIIII', 'IIIIIIIIZIII', 'IIIIIIZIIIII', 'IIIIIIIIIIZZ', 'IIIIIIIIIZIZ', 'IIIIIIIZIIIZ', 'IIIIIZIIIIIZ', 'IIIZIIIIIIIZ', 'IZIIIIIIIIIZ', 'IIIIIIIIZIZI', 'IIIIIIZIIIZI', 'IIIIZIIIIIZI', 'IIZIIIIIIIZI', 'ZIIIIIIIIIZI', 'IIIIIIIIZZII', 'IIIIIIIZIZII', 'IIIIIZIIIZII', 'IIIZIIIIIZII', 'IZIIIIIIIZII', 'IIIIIIZIZIII', 'IIIIZIIIZIII', 'IIZIIIIIZIII', 'ZIIIIIIIZIII', 'IIIIIIZZIIII', 'IIIIIZIZIIII', 'IIIZIIIZIIII', 'IZIIIIIZIIII', 'IIIIZIZIIIII', 'IIZIIIZIIIII', 'ZIIIIIZIIIII', 'IIIIZZIIIIII', 'IIIZIZIIIIII', 'IZIIIZIIIIII', 'IIZIZIIIIIII', 'ZIIIZIIIIIII', 'IIZZIIIIIIII', 'IZIZIIIIIIII', 'ZIZIIIIIIIII', 'ZZIIIIIIIIII'],
              coeffs=[-1444.25+0.j, -1444.25+0.j, -1444.25+0.j, -1444.25+0.j,  8665.5 +0.j,
    15.  +0.j,    20.  +0.j,    10.  +0.j,    15.  +0.j,    22.5 +0.j,
    15.  +0.j,    20.  +0.j,    10.  +0.j,    15.  +0.j,    22.5 +0.j,
  8665.5 +0.j,  1468.25+0.j,    12.  +0.j,    18.  +0.j,    27.  +0.j,
  1468.25+0.j,    12.  +0.j,    18.  +0.j,    27.  +0.j,  8665.5 +0.j,
    16.  +0.j,    24.  +0.j,    36.  +0.j,    16.  +0.j,    24.  +0.j,
    36.  +0.j,  8665.5 +0.j,    12.  +0.j,    18.  +0.j,    12.  +0.j,
    18.  +0.j,  8665.5 +0.j,    27.  +0.j,    27.  +0.j,  8665.5 +0.j])</code></pre>
</div>
</div>
</section>
</section>
<section id="vqe-preparation" class="level2">
<h2 class="anchored" data-anchor-id="vqe-preparation">2 - VQE Preparation</h2>
<p>Now that we have our Hamiltonian operator, we can start defining the VQE itself.</p>
<p>Since we will use simulators, we do not need to worry about the transpiler (complex optimization that prepares the circuit for the chosen real hardware) or error mitigation. Therefore, let’s start with the Ansatz.</p>
<section id="ansatz" class="level3">
<h3 class="anchored" data-anchor-id="ansatz">Ansatz</h3>
<p>It is a parameterized quantum circuit. The VQE will try to find the parameters that prepare the state of lowest energy.</p>
<ul>
<li><code>EfficientSU2</code> is a common choice, which tends to be good in many cases.</li>
</ul>
<p>Being a circuit, under the hood it implements logic gates and entanglement modes.</p>
<p>For educational purposes, we can check the internal circuit, but it is not strictly necessary.</p>
<div id="94771a7f" class="cell" data-execution_count="16">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>ansatz <span class="op">=</span> EfficientSU2(num_qubits, reps<span class="op">=</span><span class="dv">1</span>, entanglement<span class="op">=</span><span class="st">'linear'</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>ansatz.draw(<span class="st">"mpl"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_700894/3793753533.py:1: DeprecationWarning: The class ``qiskit.circuit.library.n_local.efficient_su2.EfficientSU2`` is deprecated as of Qiskit 2.1. It will be removed in Qiskit 3.0. Use the function qiskit.circuit.library.efficient_su2 instead.
  ansatz = EfficientSU2(num_qubits, reps=1, entanglement='linear')</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="55">
<div>
<figure class="figure">
<p><img src="vqe_in_practice_files/figure-html/cell-17-output-2.png" width="678" height="786" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="0cce2e23" class="cell" data-execution_count="17">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>ansatz.decompose().draw(<span class="st">"mpl"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="56">
<div>
<figure class="figure">
<p><img src="vqe_in_practice_files/figure-html/cell-18-output-1.png" width="1049" height="786" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>We can alter parameters, such as repetition (creates more layers of rotations and CNOT gates) and entanglement type.</p>
<p>For example, see the circuit with full entanglement:</p>
<div id="1aa3618a" class="cell" data-execution_count="18">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>EfficientSU2(num_qubits, reps<span class="op">=</span><span class="dv">1</span>, entanglement<span class="op">=</span><span class="st">'full'</span>).decompose().draw(<span class="st">"mpl"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_700894/2482604393.py:1: DeprecationWarning: The class ``qiskit.circuit.library.n_local.efficient_su2.EfficientSU2`` is deprecated as of Qiskit 2.1. It will be removed in Qiskit 3.0. Use the function qiskit.circuit.library.efficient_su2 instead.
  EfficientSU2(num_qubits, reps=1, entanglement='full').decompose().draw("mpl")</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="57">
<div>
<figure class="figure">
<p><img src="vqe_in_practice_files/figure-html/cell-19-output-2.png" width="1667" height="2393" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Although it provides stronger entanglement between qubits, the number of applied logic gates is much higher.</p>
<p>This can cause slowness in the algorithm execution, since the circuit is more complex, and, worse still, it exponentially increases the probability of errors if trying to execute the circuit on a real computer.</p>
<p>For our example, let’s stick with linear entanglement, but using two repetitions.</p>
<div id="9170ada5" class="cell" data-execution_count="19">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>ansatz <span class="op">=</span> EfficientSU2(num_qubits, reps<span class="op">=</span><span class="dv">2</span>, entanglement<span class="op">=</span><span class="st">'linear'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stderr">
<pre><code>/tmp/ipykernel_700894/1553661934.py:1: DeprecationWarning: The class ``qiskit.circuit.library.n_local.efficient_su2.EfficientSU2`` is deprecated as of Qiskit 2.1. It will be removed in Qiskit 3.0. Use the function qiskit.circuit.library.efficient_su2 instead.
  ansatz = EfficientSU2(num_qubits, reps=2, entanglement='linear')</code></pre>
</div>
</div>
</section>
<section id="classical-optimizer" class="level3">
<h3 class="anchored" data-anchor-id="classical-optimizer">Classical Optimizer</h3>
<p>It is the classical algorithm that will adjust the Ansatz parameters.</p>
<ul>
<li><code>COBYLA</code> is a good option for our case, since it does not require gradients, making it suitable for simulators.</li>
</ul>
<p>Furthermore, we need to define an estimator, which will execute the circuit and measure the results.</p>
<ul>
<li>For our case in the simulator, we will use <code>AerEstimator</code>.</li>
</ul>
<div id="a53b551f" class="cell" data-execution_count="20">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>estimator <span class="op">=</span> AerEstimator(</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    run_options<span class="op">=</span>{<span class="st">"shots"</span>: <span class="va">None</span>, <span class="st">"seed"</span>: <span class="dv">42</span>}, <span class="co"># Use an ideal simulator without shot noise</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    approximation<span class="op">=</span><span class="va">True</span> <span class="co"># Allows exact calculation of expectation value, without sampling</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="cost-function" class="level3">
<h3 class="anchored" data-anchor-id="cost-function">Cost Function</h3>
<p>Here, we will define the cost function in code that will be minimized by the algorithm.</p>
<p>We will add some logs showing how the energy changes at each iteration.</p>
<div id="0180d1fb" class="cell" data-execution_count="21">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List to store cost history for later plotting</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>cost_history <span class="op">=</span> []</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>iteration_count <span class="op">=</span> <span class="dv">0</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="934d6ee0" class="cell" data-execution_count="22">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cost function to be minimized (calculates energy)</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cost_func(params: Sequence) <span class="op">-&gt;</span> <span class="bu">float</span>:</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Calculates the expectation value (energy) and logs progress."""</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">global</span> iteration_count</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Each pub is a tuple of (circuit, observables, parameter_values)</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> estimator.run(</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>        circuits<span class="op">=</span>[ansatz],</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>        observables<span class="op">=</span>[hamiltonian],</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>        parameter_values<span class="op">=</span>[params]</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    ).result()</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    energy <span class="op">=</span> result.values[<span class="dv">0</span>]</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    cost_history.append(energy)</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    iteration_count <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Iteration: </span><span class="sc">{</span>iteration_count<span class="sc">}</span><span class="ss"> | Cost (Energy): </span><span class="sc">{</span>energy<span class="sc">:.5f}</span><span class="ss">"</span>, end<span class="op">=</span><span class="st">"</span><span class="ch">\r</span><span class="st">"</span>, flush<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> energy</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</section>
<section id="algorithm-execution" class="level3">
<h3 class="anchored" data-anchor-id="algorithm-execution">Algorithm Execution</h3>
<p>Here, we will define the initial parameters for the algorithm.</p>
<p>Then, we construct the minimization function using <code>scipy</code>, passing the optimizer we chose earlier, and run the algorithm.</p>
<div id="633ffcca" class="cell" data-execution_count="23">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Random initial parameters</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>num_params <span class="op">=</span> ansatz.num_parameters</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">42</span>) <span class="co"># Setting seed for reproducibility</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>initial_params <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> np.pi <span class="op">*</span> np.random.random(num_params)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="2c889998" class="cell" data-execution_count="24">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Starting optimization with scipy.minimize..."</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Optimization using COBYLA method via SciPy</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>res <span class="op">=</span> minimize(</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    fun<span class="op">=</span>cost_func,</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    x0<span class="op">=</span>initial_params,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    method<span class="op">=</span><span class="st">"COBYLA"</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>    options<span class="op">=</span>{<span class="st">"maxiter"</span>: <span class="dv">300</span>},</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Optimization completed."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Starting optimization with scipy.minimize...
Iteration: 1 | Cost (Energy): -8.44752Iteration: 2 | Cost (Energy): -1058.91363Iteration: 3 | Cost (Energy): -627.62211Iteration: 4 | Cost (Energy): 1681.47942Iteration: 5 | Cost (Energy): -1191.53720Iteration: 6 | Cost (Energy): -2406.99060Iteration: 7 | Cost (Energy): -2679.87220Iteration: 8 | Cost (Energy): -3617.81497Iteration: 9 | Cost (Energy): -4191.81213Iteration: 10 | Cost (Energy): -4330.71835Iteration: 11 | Cost (Energy): -4261.37213Iteration: 12 | Cost (Energy): -4553.65096Iteration: 13 | Cost (Energy): -1297.22890Iteration: 14 | Cost (Energy): -4657.36421Iteration: 15 | Cost (Energy): -5738.25036Iteration: 16 | Cost (Energy): -5850.10450Iteration: 17 | Cost (Energy): -2825.07021Iteration: 18 | Cost (Energy): -5461.55735Iteration: 19 | Cost (Energy): -4025.28939Iteration: 20 | Cost (Energy): -5641.28149Iteration: 21 | Cost (Energy): -6412.87707Iteration: 22 | Cost (Energy): -5843.98181Iteration: 23 | Cost (Energy): -5788.01458Iteration: 24 | Cost (Energy): -5870.31748Iteration: 25 | Cost (Energy): -6736.19698Iteration: 26 | Cost (Energy): -5819.67241Iteration: 27 | Cost (Energy): -807.06149Iteration: 28 | Cost (Energy): -6147.06173Iteration: 29 | Cost (Energy): -6345.66948Iteration: 30 | Cost (Energy): -6216.01937Iteration: 31 | Cost (Energy): -10411.84517Iteration: 32 | Cost (Energy): -10768.94160Iteration: 33 | Cost (Energy): -10772.03106Iteration: 34 | Cost (Energy): -10800.45405Iteration: 35 | Cost (Energy): -11087.20427Iteration: 36 | Cost (Energy): -11565.19893Iteration: 37 | Cost (Energy): -11118.54323Iteration: 38 | Cost (Energy): -11546.21839Iteration: 39 | Cost (Energy): -9742.40698Iteration: 40 | Cost (Energy): -9684.18081Iteration: 41 | Cost (Energy): -11287.16644Iteration: 42 | Cost (Energy): -10989.89560Iteration: 43 | Cost (Energy): -11853.85624Iteration: 44 | Cost (Energy): -10829.17117Iteration: 45 | Cost (Energy): -11838.19465Iteration: 46 | Cost (Energy): -11244.46393Iteration: 47 | Cost (Energy): -11831.04262Iteration: 48 | Cost (Energy): -12037.86175Iteration: 49 | Cost (Energy): -11993.98457Iteration: 50 | Cost (Energy): -9961.95947Iteration: 51 | Cost (Energy): -12995.58205Iteration: 52 | Cost (Energy): -10191.53589Iteration: 53 | Cost (Energy): -12172.57513Iteration: 54 | Cost (Energy): -12397.28262Iteration: 55 | Cost (Energy): -13071.38966Iteration: 56 | Cost (Energy): -13113.94779Iteration: 57 | Cost (Energy): -10002.17885Iteration: 58 | Cost (Energy): -13517.66842Iteration: 59 | Cost (Energy): -13258.93070Iteration: 60 | Cost (Energy): -12860.16157Iteration: 61 | Cost (Energy): -14322.21787Iteration: 62 | Cost (Energy): -14322.21787Iteration: 63 | Cost (Energy): -14322.21787Iteration: 64 | Cost (Energy): -14322.21787Iteration: 65 | Cost (Energy): -14322.21787Iteration: 66 | Cost (Energy): -14322.21787Iteration: 67 | Cost (Energy): -14322.21787Iteration: 68 | Cost (Energy): -14322.21787Iteration: 69 | Cost (Energy): -14322.21787Iteration: 70 | Cost (Energy): -14322.21787Iteration: 71 | Cost (Energy): -14322.21787Iteration: 72 | Cost (Energy): -14322.21787Iteration: 73 | Cost (Energy): -14322.21787Iteration: 74 | Cost (Energy): -17499.53675Iteration: 75 | Cost (Energy): -13856.27679Iteration: 76 | Cost (Energy): -18105.18249Iteration: 77 | Cost (Energy): -21169.01040Iteration: 78 | Cost (Energy): -23052.61646Iteration: 79 | Cost (Energy): -14708.93652Iteration: 80 | Cost (Energy): -21874.43579Iteration: 81 | Cost (Energy): -20883.37161Iteration: 82 | Cost (Energy): -25029.58996Iteration: 83 | Cost (Energy): -24844.73636Iteration: 84 | Cost (Energy): -25506.23787Iteration: 85 | Cost (Energy): -22497.35670Iteration: 86 | Cost (Energy): -22976.22579Iteration: 87 | Cost (Energy): -27964.89612Iteration: 88 | Cost (Energy): -29116.62685Iteration: 89 | Cost (Energy): -26478.54611Iteration: 90 | Cost (Energy): -28912.62950Iteration: 91 | Cost (Energy): -29726.84389Iteration: 92 | Cost (Energy): -29397.97827Iteration: 93 | Cost (Energy): -28887.80900Iteration: 94 | Cost (Energy): -29062.32400Iteration: 95 | Cost (Energy): -29119.54266Iteration: 96 | Cost (Energy): -27790.83814Iteration: 97 | Cost (Energy): -28330.91387Iteration: 98 | Cost (Energy): -28786.55281Iteration: 99 | Cost (Energy): -28090.71874Iteration: 100 | Cost (Energy): -27508.78385Iteration: 101 | Cost (Energy): -29603.57815Iteration: 102 | Cost (Energy): -27637.67851Iteration: 103 | Cost (Energy): -28626.60369Iteration: 104 | Cost (Energy): -27357.92472Iteration: 105 | Cost (Energy): -29287.55178Iteration: 106 | Cost (Energy): -30202.47583Iteration: 107 | Cost (Energy): -29143.34863Iteration: 108 | Cost (Energy): -30581.72625Iteration: 109 | Cost (Energy): -27296.27766Iteration: 110 | Cost (Energy): -30294.83255Iteration: 111 | Cost (Energy): -31138.82553Iteration: 112 | Cost (Energy): -29177.90999Iteration: 113 | Cost (Energy): -31229.89436Iteration: 114 | Cost (Energy): -29247.76765Iteration: 115 | Cost (Energy): -28699.38973Iteration: 116 | Cost (Energy): -32480.35508Iteration: 117 | Cost (Energy): -31555.58914Iteration: 118 | Cost (Energy): -32012.67275Iteration: 119 | Cost (Energy): -33522.90192Iteration: 120 | Cost (Energy): -28104.79797Iteration: 121 | Cost (Energy): -32760.96129Iteration: 122 | Cost (Energy): -33661.15230Iteration: 123 | Cost (Energy): -32003.66391Iteration: 124 | Cost (Energy): -31787.90803Iteration: 125 | Cost (Energy): -28233.15410Iteration: 126 | Cost (Energy): -31929.29320Iteration: 127 | Cost (Energy): -33457.64457Iteration: 128 | Cost (Energy): -33950.10010Iteration: 129 | Cost (Energy): -31477.15134Iteration: 130 | Cost (Energy): -33956.68401Iteration: 131 | Cost (Energy): -29373.71589Iteration: 132 | Cost (Energy): -33675.81982Iteration: 133 | Cost (Energy): -32541.79233Iteration: 134 | Cost (Energy): -34176.25686Iteration: 135 | Cost (Energy): -33601.33013Iteration: 136 | Cost (Energy): -33795.18151Iteration: 137 | Cost (Energy): -33338.37779Iteration: 138 | Cost (Energy): -33777.40045Iteration: 139 | Cost (Energy): -30412.56815Iteration: 140 | Cost (Energy): -34086.18067Iteration: 141 | Cost (Energy): -33658.84762Iteration: 142 | Cost (Energy): -33008.11130Iteration: 143 | Cost (Energy): -33111.95446Iteration: 144 | Cost (Energy): -33124.15328Iteration: 145 | Cost (Energy): -31184.87913Iteration: 146 | Cost (Energy): -33986.36574Iteration: 147 | Cost (Energy): -30359.20016Iteration: 148 | Cost (Energy): -33724.57596Iteration: 149 | Cost (Energy): -32499.81095Iteration: 150 | Cost (Energy): -33514.75214Iteration: 151 | Cost (Energy): -33874.42717Iteration: 152 | Cost (Energy): -32488.03491Iteration: 153 | Cost (Energy): -33672.94774Iteration: 154 | Cost (Energy): -31009.93291Iteration: 155 | Cost (Energy): -31041.42418Iteration: 156 | Cost (Energy): -33403.22402Iteration: 157 | Cost (Energy): -34509.64936Iteration: 158 | Cost (Energy): -32249.45329Iteration: 159 | Cost (Energy): -33863.99778Iteration: 160 | Cost (Energy): -31125.11131Iteration: 161 | Cost (Energy): -34575.11594Iteration: 162 | Cost (Energy): -33469.70401Iteration: 163 | Cost (Energy): -34470.98474Iteration: 164 | Cost (Energy): -33205.02634Iteration: 165 | Cost (Energy): -33174.57756Iteration: 166 | Cost (Energy): -35467.27252Iteration: 167 | Cost (Energy): -32900.10618Iteration: 168 | Cost (Energy): -35467.27252Iteration: 169 | Cost (Energy): -29240.52500Iteration: 170 | Cost (Energy): -35467.27252Iteration: 171 | Cost (Energy): -34410.05571Iteration: 172 | Cost (Energy): -35467.27252Iteration: 173 | Cost (Energy): -31188.20859Iteration: 174 | Cost (Energy): -35467.27252Iteration: 175 | Cost (Energy): -35764.39551Iteration: 176 | Cost (Energy): -33354.69609Iteration: 177 | Cost (Energy): -35722.97464Iteration: 178 | Cost (Energy): -33849.94327Iteration: 179 | Cost (Energy): -35438.94203Iteration: 180 | Cost (Energy): -29356.57262Iteration: 181 | Cost (Energy): -35368.00896Iteration: 182 | Cost (Energy): -30403.59882Iteration: 183 | Cost (Energy): -35839.97134Iteration: 184 | Cost (Energy): -35101.66413Iteration: 185 | Cost (Energy): -35612.11429Iteration: 186 | Cost (Energy): -33849.16183Iteration: 187 | Cost (Energy): -35455.33140Iteration: 188 | Cost (Energy): -33762.13561Iteration: 189 | Cost (Energy): -35839.97134Iteration: 190 | Cost (Energy): -36662.56800Iteration: 191 | Cost (Energy): -35290.75331Iteration: 192 | Cost (Energy): -34905.93852Iteration: 193 | Cost (Energy): -37349.55161Iteration: 194 | Cost (Energy): -36697.88968Iteration: 195 | Cost (Energy): -37429.34396Iteration: 196 | Cost (Energy): -37591.94988Iteration: 197 | Cost (Energy): -37885.12610Iteration: 198 | Cost (Energy): -38414.17814Iteration: 199 | Cost (Energy): -37334.60317Iteration: 200 | Cost (Energy): -37453.42055Iteration: 201 | Cost (Energy): -34636.84259Iteration: 202 | Cost (Energy): -38241.20497Iteration: 203 | Cost (Energy): -33094.73762Iteration: 204 | Cost (Energy): -36636.60565Iteration: 205 | Cost (Energy): -37961.75039Iteration: 206 | Cost (Energy): -38776.23733Iteration: 207 | Cost (Energy): -33408.99968Iteration: 208 | Cost (Energy): -38693.86771Iteration: 209 | Cost (Energy): -37190.62331Iteration: 210 | Cost (Energy): -38712.56482Iteration: 211 | Cost (Energy): -34204.90131Iteration: 212 | Cost (Energy): -39035.49535Iteration: 213 | Cost (Energy): -35385.56428Iteration: 214 | Cost (Energy): -38688.61875Iteration: 215 | Cost (Energy): -34972.68762Iteration: 216 | Cost (Energy): -39487.30323Iteration: 217 | Cost (Energy): -40400.32674Iteration: 218 | Cost (Energy): -36790.83321Iteration: 219 | Cost (Energy): -39517.06662Iteration: 220 | Cost (Energy): -40044.07870Iteration: 221 | Cost (Energy): -40370.37084Iteration: 222 | Cost (Energy): -39753.71089Iteration: 223 | Cost (Energy): -39326.46731Iteration: 224 | Cost (Energy): -39990.47340Iteration: 225 | Cost (Energy): -38526.03505Iteration: 226 | Cost (Energy): -36721.33651Iteration: 227 | Cost (Energy): -40090.43212Iteration: 228 | Cost (Energy): -37706.12256Iteration: 229 | Cost (Energy): -38900.83644Iteration: 230 | Cost (Energy): -37740.56666Iteration: 231 | Cost (Energy): -39680.80496Iteration: 232 | Cost (Energy): -38536.01878Iteration: 233 | Cost (Energy): -39835.48057Iteration: 234 | Cost (Energy): -40439.15519Iteration: 235 | Cost (Energy): -37381.67792Iteration: 236 | Cost (Energy): -39037.68744Iteration: 237 | Cost (Energy): -38304.62674Iteration: 238 | Cost (Energy): -39830.99142Iteration: 239 | Cost (Energy): -37581.58602Iteration: 240 | Cost (Energy): -38907.73948Iteration: 241 | Cost (Energy): -37262.47463Iteration: 242 | Cost (Energy): -40991.96265Iteration: 243 | Cost (Energy): -38046.04408Iteration: 244 | Cost (Energy): -41129.86614Iteration: 245 | Cost (Energy): -39557.32199Iteration: 246 | Cost (Energy): -39204.98960Iteration: 247 | Cost (Energy): -37526.79676Iteration: 248 | Cost (Energy): -41029.65674Iteration: 249 | Cost (Energy): -39208.73440Iteration: 250 | Cost (Energy): -40856.77461Iteration: 251 | Cost (Energy): -39428.54091Iteration: 252 | Cost (Energy): -40827.59691Iteration: 253 | Cost (Energy): -39247.36358Iteration: 254 | Cost (Energy): -41098.97584Iteration: 255 | Cost (Energy): -37679.90519Iteration: 256 | Cost (Energy): -41155.29946Iteration: 257 | Cost (Energy): -40404.80208Iteration: 258 | Cost (Energy): -38511.70745Iteration: 259 | Cost (Energy): -40254.51739Iteration: 260 | Cost (Energy): -41373.35056Iteration: 261 | Cost (Energy): -38192.68477Iteration: 262 | Cost (Energy): -40945.08195Iteration: 263 | Cost (Energy): -41054.76902Iteration: 264 | Cost (Energy): -41058.93057Iteration: 265 | Cost (Energy): -37669.58815Iteration: 266 | Cost (Energy): -40426.39577Iteration: 267 | Cost (Energy): -36669.33908Iteration: 268 | Cost (Energy): -41265.85067Iteration: 269 | Cost (Energy): -40282.88059Iteration: 270 | Cost (Energy): -41111.35575Iteration: 271 | Cost (Energy): -38236.08210Iteration: 272 | Cost (Energy): -40267.11235Iteration: 273 | Cost (Energy): -38620.21800Iteration: 274 | Cost (Energy): -40851.29459Iteration: 275 | Cost (Energy): -40039.82120Iteration: 276 | Cost (Energy): -41380.99719Iteration: 277 | Cost (Energy): -38735.39229Iteration: 278 | Cost (Energy): -41443.63653Iteration: 279 | Cost (Energy): -40283.33976Iteration: 280 | Cost (Energy): -41454.00853Iteration: 281 | Cost (Energy): -38183.78315Iteration: 282 | Cost (Energy): -41093.02966Iteration: 283 | Cost (Energy): -36162.92095Iteration: 284 | Cost (Energy): -40797.15513Iteration: 285 | Cost (Energy): -39656.16354Iteration: 286 | Cost (Energy): -39559.18408Iteration: 287 | Cost (Energy): -41716.50699Iteration: 288 | Cost (Energy): -38797.32295Iteration: 289 | Cost (Energy): -40946.86367Iteration: 290 | Cost (Energy): -38779.50198Iteration: 291 | Cost (Energy): -41560.71775Iteration: 292 | Cost (Energy): -41453.47543Iteration: 293 | Cost (Energy): -41327.90965Iteration: 294 | Cost (Energy): -37555.70687Iteration: 295 | Cost (Energy): -40321.59424Iteration: 296 | Cost (Energy): -42307.69287Iteration: 297 | Cost (Energy): -42081.18614Iteration: 298 | Cost (Energy): -42408.28796Iteration: 299 | Cost (Energy): -41750.61561Iteration: 300 | Cost (Energy): -43096.23013
Optimization completed.</code></pre>
</div>
</div>
<div id="7fefa55a" class="cell" data-execution_count="25">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>optimal_params <span class="op">=</span> res.x</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The function value returned by `minimize` is the Hamiltonian value</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>min_hamiltonian_value <span class="op">=</span> res.fun</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The actual energy of the original problem includes the conversion offset to Ising</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>min_energy <span class="op">=</span> min_hamiltonian_value <span class="op">+</span> offset</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="9f543919" class="cell" data-execution_count="26">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Minimum Hamiltonian value (eigenvalue): </span><span class="sc">{</span>min_hamiltonian_value<span class="sc">:.5f}</span><span class="ss">"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Conversion offset: </span><span class="sc">{</span>offset<span class="sc">:.5f}</span><span class="ss">"</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Final minimum solution energy (objective value): </span><span class="sc">{</span>min_energy<span class="sc">:.5f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Minimum Hamiltonian value (eigenvalue): -43096.23013
Conversion offset: 55010.50000
Final minimum solution energy (objective value): 11914.26987</code></pre>
</div>
</div>
</section>
</section>
<section id="post-processing-and-analysis" class="level2">
<h2 class="anchored" data-anchor-id="post-processing-and-analysis">3 - Post-Processing and Analysis</h2>
<p>Finally, we need to post-process the VQE results to make them interpretable.</p>
<p>First, let’s run the circuit one last time, using the parameters optimized by VQE:</p>
<div id="43c06d56" class="cell" data-execution_count="27">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Build the optimal circuit with the found parameters</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>optimal_circuit <span class="op">=</span> ansatz.assign_parameters(optimal_params)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>optimal_circuit.measure_all()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="ff3e1f24" class="cell" data-execution_count="28">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Sample the final state to find the most probable bitstring</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> AerSampler()</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>job <span class="op">=</span> sampler.run([optimal_circuit], shots<span class="op">=</span><span class="dv">1024</span>)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>result_sampler <span class="op">=</span> job.result()</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> result_sampler.quasi_dists[<span class="dv">0</span>].binary_probabilities()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="0a0aec9e" class="cell" data-execution_count="29">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>solution_bitstring <span class="op">=</span> <span class="bu">max</span>(counts, key<span class="op">=</span>counts.get)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Now that we have our final result, let’s interpret it as the result of our problem.</p>
<p>The first step is to translate the obtained bitstring, considering the differences between the Qiskit convention and the usual one.</p>
<div id="c2896b52" class="cell" data-execution_count="30">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Translate the bitstring back to the problem solution</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The bitstring is converted to an array of integers and reversed (little-endian).</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>qubo_solution_vector <span class="op">=</span> np.array([<span class="bu">int</span>(s) <span class="cf">for</span> s <span class="kw">in</span> solution_bitstring[::<span class="op">-</span><span class="dv">1</span>]])</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>solution_vars_list <span class="op">=</span> converter.interpret(qubo_solution_vector)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="e4769c27" class="cell" data-execution_count="31">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dictionary to facilitate variable lookup by name</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>solution_vars_dict <span class="op">=</span> {var.name: val <span class="cf">for</span> var, val <span class="kw">in</span> <span class="bu">zip</span>(qp.variables, solution_vars_list)}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>Then, we can create a helper function to show the results:</p>
<div id="5171f341" class="cell" data-execution_count="32">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Display the solution in a readable way</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> display_solution(solution_dict, players_data, teams):</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    team_A <span class="op">=</span> {<span class="st">"name"</span>: teams[<span class="dv">0</span>], <span class="st">"players"</span>: [], <span class="st">"strength"</span>: <span class="dv">0</span>}</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    team_B <span class="op">=</span> {<span class="st">"name"</span>: teams[<span class="dv">1</span>], <span class="st">"players"</span>: [], <span class="st">"strength"</span>: <span class="dv">0</span>}</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, player <span class="kw">in</span> <span class="bu">enumerate</span>(players_data):</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> solution_dict.get(<span class="ss">f'x_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_0'</span>, <span class="dv">0</span>) <span class="op">&gt;</span> <span class="fl">0.5</span>:</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>            team_A[<span class="st">"players"</span>].append(player[<span class="st">'name'</span>])</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>            team_A[<span class="st">"strength"</span>] <span class="op">+=</span> player[<span class="st">'strength'</span>]</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> solution_dict.get(<span class="ss">f'x_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">_1'</span>, <span class="dv">0</span>) <span class="op">&gt;</span> <span class="fl">0.5</span>:</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>            team_B[<span class="st">"players"</span>].append(player[<span class="st">'name'</span>])</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>            team_B[<span class="st">"strength"</span>] <span class="op">+=</span> player[<span class="st">'strength'</span>]</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> team_A, team_B</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>With this, we can print our results:</p>
<div id="d75348ba" class="cell" data-execution_count="33">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>team_A, team_B <span class="op">=</span> display_solution(solution_vars_dict, players_data, teams)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<div id="b54cef6b" class="cell" data-execution_count="34">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">--- Final Team Composition ---"</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Solution bitstring (little-endian): </span><span class="sc">{</span>solution_bitstring<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Team </span><span class="sc">{</span>team_A[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Players: </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(team_A[<span class="st">'players'</span>])<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Total Strength: </span><span class="sc">{</span>team_A[<span class="st">'strength'</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"-"</span> <span class="op">*</span> <span class="dv">20</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Team </span><span class="sc">{</span>team_B[<span class="st">'name'</span>]<span class="sc">}</span><span class="ss">:"</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Players: </span><span class="sc">{</span><span class="st">', '</span><span class="sc">.</span>join(team_B[<span class="st">'players'</span>])<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"  Total Strength: </span><span class="sc">{</span>team_B[<span class="st">'strength'</span>]<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
--- Final Team Composition ---
Solution bitstring (little-endian): 101001100101
Team Alpha:
  Players: Alice, Bob, Danny
  Total Strength: 15
--------------------
Team Beta:
  Players: Claire, Eve, Frank
  Total Strength: 23</code></pre>
</div>
</div>
<p>Furthermore, since we saved the results of the intermediate iterations, we can plot a graph to see the algorithm’s behavior over time:</p>
<div id="e2f572e2" class="cell" data-execution_count="35">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize energy convergence</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>plt.plot(cost_history)</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Iteration"</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Energy (Hamiltonian Value)"</span>)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"VQE Convergence"</span>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="vqe_in_practice_files/figure-html/cell-36-output-1.png" width="844" height="523" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="resources" class="level2">
<h2 class="anchored" data-anchor-id="resources">Resources</h2>
<ul>
<li><p>Example adapted from <em>The QuBlog</em>: <a href="https://www.thequblog.com/posts/how-to-solve-optimization-problems-with-aqua-qio-3/" class="uri">https://www.thequblog.com/posts/how-to-solve-optimization-problems-with-aqua-qio-3/</a></p></li>
<li><p>VQE Course (<em>IBM Quantum Learning</em>): <a href="https://quantum.cloud.ibm.com/learning/en/courses/variational-algorithm-design" class="uri">https://quantum.cloud.ibm.com/learning/en/courses/variational-algorithm-design</a></p></li>
<li><p>Qiskit Documentation: <a href="https://quantum.cloud.ibm.com/docs/en" class="uri">https://quantum.cloud.ibm.com/docs/en</a></p></li>
<li><p>Qiskit Aer Documentation: <a href="https://qiskit.github.io/qiskit-aer/apidocs/aer.html" class="uri">https://qiskit.github.io/qiskit-aer/apidocs/aer.html</a></p></li>
<li><p>Qiskit Optimization Documentation: <a href="https://qiskit-community.github.io/qiskit-optimization/apidocs/qiskit_optimization.html" class="uri">https://qiskit-community.github.io/qiskit-optimization/apidocs/qiskit_optimization.html</a></p></li>
<li><p>D-Wave Documentation (Quadratic Model Construction): <a href="https://docs.dwavequantum.com/en/latest/industrial_optimization/model_construction_qm.html#opt-model-construction-qm" class="uri">https://docs.dwavequantum.com/en/latest/industrial_optimization/model_construction_qm.html#opt-model-construction-qm</a></p></li>
</ul>
</section>
<section id="copyright-and-licensing-note" class="level2">
<h2 class="anchored" data-anchor-id="copyright-and-licensing-note">Copyright and Licensing Note</h2>
<p>
© Copyright 2025, Kauê Miziara. All rights reserved.
</p>
<p>
The text, analyses, and structure of this notebook were developed by <i>&lt;Kauê Miziara&gt;</i> as study material and reference.
</p>
<p>
The source code contained in this notebook is licensed under the terms of the <b>MIT License</b>. <br> You can obtain a copy of the license at <a href="https://opensource.org/licenses/MIT">https://opensource.org/licenses/MIT</a>.
</p>
<hr>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the “Software”), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED “AS IS”, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>